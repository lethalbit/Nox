# N5305A Notes

The following notes discuss the process of N5305A module boot up, configuration, programming, and analyses connection as seen from over the network.

## N5305A Initial Configuration

It seems like the N5305A, and all other modules for the N5540A want to have an DHCP daemon on `10.0.0.1/8` with `BOOTP` support. They also expect an FTP daemon on this same port to serve the files for module initialization and gateware.

There are also some services running on some TCP and UDP ports on the controller which look to be orchestration and control.

## N5305A boot

`TODO`

## N5305A Diagnostics

`TODO`

## N5305A Gateware Initialization

`TODO`

## N5305A Analysis

`TODO`

not smb && not smb2 && not ssdp && not arp && not nbns && not llmnr && not udp.srcport == 1024 && not tcp.srcport == 1027 && not tcp.dstport == 1027 && not udp.dstport == 70 && tcp.flags.syn == 0 && not tcp.analysis.retransmission && not tcp.analysis.duplicate_ack && tcp.flags.push == 1



## Protocol Notes


### Protocol Analyzer Packets

Port: TCP 1029 (On Analyzer)

Bytes 0-2: Flags?
 * Bit 0: ?
 * Bit 1: ?
 * Bit 2: ?
 * Bit 3: ?
 * Bit 4: ?
 * Bit 5: ?
 * Bit 6: ?
 * Bit 7: ?
 * Bit 8: ?
 * Bit 9: ?
 * Bit A: ?
 * Bit B: ?
 * Bit C: ?
 * Bit D: ?
 * Bit E: ?
 * Bit F: End of transaction

Bytes 3-4: Total frame length (BE) (Total packets length - 4 bytes)

Bytes 5-6: Unknown Value 1

Bytes 7-8: Packet Cookie / Sequence ID
 * From Analyzer to host w/ value of 0 looks to be some sort of status packet from the device. Common packet lengths are as follows 238, 160, 60, 64, 48, 52, 56, 132

Messages From Host:
 * Sometimes there are 16 bytes of "padding" between the last element of the packet and the start of the packet contents when coming from the host.

Messages To Host:
 * Look to always have 4 null bytes prior to other data, if any, meaning the minimum packet size is 12 bytes
 * Responses with the Cookie ID look to have the following `\x00\x00\x00\x00\x00\x00\x5d\xde\x00\x00\x00\x00\x01\xe0\x5a\xb8\x00\x00\x00\x00\x03\x04\x05\x58\x00\x00\x00\x00` for the 132 byte packets,`\x00\x00\x00\x00\x00\x00\x5d\xd0\x00\x00\x00\x00\x01\xbf\xc7\x18\x00\x00\x00\x00\x03\x02\xa8\x24\x00\x00\x00\x00` for the 160 byte packets, and `\x00\x00\x00\x00\x00\x00\x5d\xcd\x00\x00\x00\x00\x01\xbf\xc4\x10\x00\x00\x00\x00\x03\x01\x13\xec\x00\x00\x00\x00` for the 56 byte packets


Type 0x0058
	11 4byte BE resources
	packet counts for blob

## N5305A-pa-session-config.pcapng

Packet #25699 + #25701 + #25703 matches the notes for the session start capture below

## N5305A-pa-session-start.pcapng

Packet #25113 + 25115 + 25117:

 * #25113:
   * Odd length value (0x0FFC)
   * Preceeded by PSH'd packet to the analyser
   * Very specific frame length of 1460
 * #25115:
   * No N5305A headers (just data)
   * Also 1460 bytes
 * #25117:
   * No N5305A headers (just data)
   * 1176 bytes
   * PSH'd packet
 * 0xFFC in decimal is 4092
 * 1460 + 1460 + 1176 - 4 = 4092
 * custom frag system based on 1460 byte packets followed by trailing packet with remainder of the data and TCP PSH set

Huge data packets exactly fit 1 page of RAM (4096 bytes) once stripped of TCP framing, but including N5305A header data
End of huge packet stream has one sane-sized packet, flags 0x8000 (end of transaction set) with TCP PSH set
